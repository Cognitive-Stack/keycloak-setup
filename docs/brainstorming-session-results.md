# Brainstorming Session Results

**Session Date:** 2025-09-10
**Facilitator:** Business Analyst Mary

---

## Executive Summary

**Topic:** Keycloak Authentication Flow Configuration

**Session Goals:** To define a simple, focused, and actionable specification for a "first broker login" flow that can be generated by your auto-configuration tool, prioritizing a fast time-to-market.

**Techniques Used:** Mind Mapping

**Total Ideas Generated:** 1 complete, 3-step authentication flow.

**Key Themes Identified:**
*   Enforcing user profile completeness.
*   Restricting access based on email domain.
*   Simplifying user experience via automatic account linking.

---

## Final Flow Specification: "first-broker-login"

This flow executes when a new user logs in for the first time via an external identity provider (e.g., Google, GitHub).

### Step 1: Review User Profile
*   **Description:** The flow first ensures the user's profile contains the minimum required information.
*   **Logic:**
    1.  Check if the `firstName` or `lastName` attributes are empty or missing.
    2.  **If YES (information is missing):** Redirect the user to a mandatory profile completion form. The flow only continues after the form is submitted.
    3.  **If NO (information is present):** Proceed to Step 2.

### Step 2: Enforce Domain Access Control
*   **Description:** The flow then validates if the user is from an approved organization based on their email domain.
*   **Logic:**
    1.  Check the user's email domain against an admin-configured list.
    2.  **Configuration:** The approved list should be provided as a simple comma-separated string (e.g., `"@company-a.com,@company-b.com"`).
    3.  **If the domain is NOT on the list:** Deny the login and display an "Access Denied" error message.
    4.  **If the domain IS on the list:** Proceed to Step 3.

### Step 3: Automatic Account Linking
*   **Description:** Finally, the flow handles linking the new external provider to an existing user account to prevent duplicates.
*   **Logic:**
    1.  Check if an account with the user's email address already exists in Keycloak.
    2.  **If NO (brand new user):** Create a new user account and proceed to log them in.
    3.  **If YES (existing user):**
        *   Automatically link the new identity provider to the existing account.
        *   Display a brief, informational message to the user (e.g., "Your login has been linked to your existing account.").
        *   Proceed to log them in.

### Final Action
*   The user is successfully authenticated and redirected to the application.

---

## Action Planning

*   **Top Priority Idea:** Implement the "first-broker-login" flow as specified above.
*   **Next Steps:** Use this document as the technical specification for building the configuration logic in your tool.
*   **Resources Needed:** The logic for generating the corresponding authenticators, executions, and conditional steps within a Keycloak authentication flow JSON structure.

